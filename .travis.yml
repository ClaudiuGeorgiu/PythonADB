language: "android"

dist: "trusty"

android:
  components:
    - "tools"
    - "platform-tools"
    - "android-21"
    - "sys-img-armeabi-v7a-android-21"

# Install Python 3.6
before_install:
  - "sudo add-apt-repository -y ppa:deadsnakes/ppa"
  - "sudo apt-get update"
  - "sudo apt-get install -y python3.6"
  - "curl https://bootstrap.pypa.io/get-pip.py | sudo python3.6"

# Prepare the Android emulator
before_script:
  - "echo no | android create avd --force -n test -t android-21 --abi armeabi-v7a"
  - "emulator -avd test -no-audio -no-window &"
  - "android-wait-for-emulator"
  - "adb shell input keyevent 82 &"

install:
  - "cd $TRAVIS_BUILD_DIR"
  - "sudo pip3.6 install -r requirements.txt"

script:
  - "cd $TRAVIS_BUILD_DIR"
  - "pytest --cov=./"

after_success:
  - "cd $TRAVIS_BUILD_DIR"
  - "codecov"
